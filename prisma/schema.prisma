generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model GameSession {
  id               Int      @id @default(autoincrement())
  playerId         Int
  score            Int
  playDate         DateTime
  streakMultiplier Float    @default(1.0)
  finalScore       Int
  gameData         String?
  createdAt        DateTime @default(now())
  weekNumber       Int?
  Player           Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playDate])
  @@index([playerId])
  @@index([weekNumber])
}

model GameSettings {
  id                    Int       @id
  launchDate            DateTime
  streakBaseMultiplier  Float     @default(1.0)
  streakIncrementPerDay Float     @default(0.1)
  secondsPerDay         Int?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  weeklyResetDay        Int       @default(0)
  weeklyResetEnabled    Boolean   @default(false)
  currentWeekNumber     Int?
  gameState             GameState @default(ACTIVE)
  referralExtraPlays    Int       @default(3)
}

model Player {
  id                  Int            @id @default(autoincrement())
  walletAddress       String         @unique @db.VarChar(42)
  launchDate          DateTime?
  totalScore          Int            @default(0)
  currentStreak       Int            @default(0)
  longestStreak       Int            @default(0)
  lastPlayDate        DateTime?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime
  lifetimeTotalScore  Int            @default(0)
  weeklyScore         Int            @default(0)
  weeklyStreak        Int            @default(0)
  weeklyLongestStreak Int            @default(0)
  lastResetWeekNumber Int?
  GameSession         GameSession[]
  PlayerStreak        PlayerStreak[]
}

model PlayerStreak {
  id          Int      @id @default(autoincrement())
  playerId    Int
  streakDate  DateTime
  streakCount Int
  createdAt   DateTime @default(now())
  Player      Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([streakDate])
}

model ReferralCode {
  id              Int      @id @default(autoincrement())
  walletAddress   String   @unique @db.VarChar(42)
  code            String   @db.VarChar(255)
  extraPlaysUsed  Int      @default(0)
  extraPlaysTotal Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([code])
  @@index([walletAddress])
}

model WeeklyScoreSnapshot {
  id                  Int      @id @default(autoincrement())
  weekNumber          Int
  playerId            Int
  walletAddress       String   @db.VarChar(42)
  weeklyScore         Int
  weeklyStreak        Int
  weeklyLongestStreak Int
  lifetimeTotalScore  Int
  snapshotDate        DateTime @default(now())

  @@index([playerId])
  @@index([snapshotDate])
  @@index([walletAddress])
  @@index([weekNumber])
}

enum GameState {
  ACTIVE
  IN_MAINTENANCE
  DISABLED
}
